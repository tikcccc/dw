### 6.2 功能列表（权限优化版）

#### 模块一：认证与用户管理

| 功能ID | 模块 | 描述 | 目标 | 优先级 | 依赖 | 成功标准 |
| --- | --- | --- | --- | --- | --- | --- |
| **F-001** | 登录认证 | 实现 Autodesk ACC 三步认证流程，获取用户 token 与基本信息（邮箱、ACC ID），重定向至统一认证页面 | 接入 ACC，完成统一登录 | 高 | ACC OAuth API | 成功获取 token 并登录系统 |
| **F-002** | 用户信息存储 | 用户信息持久化存储（邮箱、ACC ID、首次/末次登录时间） | 建立本地用户体系| 高 | 用户表| 用户记录完整写入 |
| **F-003** | 用户角色识别与分配 | 登录后根据邮箱匹配预配置角色（普通用户/授权用户/管理员），管理员可通过邮箱邀请用户并分配角色 | 三级权限控制体系 | 高 | 用户表、角色表、邮箱邀请系统 | 登录后权限实时生效，邮箱邀请成功 |
| **F-004** | 权限继承与分层控制 | 实现高级角色继承低级角色权限：普通用户（查看）→授权用户（自有文件操作）→管理员（全部文件操作+系统管理）。系统自动跟踪文件所有权，记录每个文件的上传者，支持基于文件所有权的权限验证，确保授权用户只能操作自己上传的文件 | 精细化权限控制与文件所有权管理 | 高 | RBAC权限模型、权限继承机制、文件所有权跟踪服务 | 各角色只能访问授权功能，权限继承正确，文件所有权验证准确 |
| **F-005** | 管理后台权限 | 管理员访问独立管理后台，管理用户角色、查看活动日志、邀请用户 | 系统管理能力 | 高 | 管理后台、用户管理模块、日志系统 | 管理员能完整管理系统用户和权限 |

#### 模块二：项目与模型管理

| 功能ID | 模块 | 描述 | 目标 | 优先级 | 依赖 | 成功标准 |
| --- | --- | --- | --- | --- | --- | --- |
| **F-007** | 项目管理 | 管理员创建/编辑/归档项目（名称、描述、时间范围），支持项目状态管理 | 项目为最小管理单元 | 高 | 项目表 | 项目创建后出现在可操作列表 |
| **F-008** | 模型文件关联 | 管理员从 ACC 选择 BIM 文件关联到项目（支持多文件），记录文件元数据 | 建立模型入口 | 高 | ACC 文件接口、项目表 | 模型成功加载且可操作 |
| **F-009** | 多模型管理 | 项目关联多个 ACC 模型，支持模型列表管理、模型间切换浏览、跨模型构件检索和绑定关系保持 | 复杂工程场景支持 | 中 | 模型关系表、模型切换服务 | 模型切换响应≤2s，跨模型检索准确率≥95% |
| **F-010** | 模型更新同步 | 当 ACC 模型更新时，系统自动/手动同步元数据并提示版本差异 | 保持模型数据时效性 | 高 | ACC Webhook、版本比对逻辑 | 变更构件可识别并更新 |

#### 模块三：HyD Code 系统

| 功能ID | 模块 | 描述 | 目标 | 优先级 | 依赖 | 成功标准 |
| --- | --- | --- | --- | --- | --- | --- |
| **F-011** | HyD Code 解析与验证 | 加载模型后自动解析 HyD Code 属性，构建结构化构件索引，验证 HyD Code 完整性 | 构件筛选与绑定的基础 | 高 | Viewer SDK、属性解析逻辑 | ≥95%构件解析成功，无HyD Code构件标记并提示 |
| **F-012** | HyD Code 7级筛选器 | 基于 HyD Code 生成动态 7 级联动筛选器，默认产生黄色高亮和列表筛选，手动点击产生蓝色高亮优先级更高；直接影响BIM视图高亮显示；| 精准定位构件与智能交互，支持灵活的联合筛选模式 | 最高 | 构件索引数据、高亮系统、交互逻辑、F-048双向联合筛选管理 | 筛选响应≤800ms，优先级逻辑准确执行，双向筛选联动准确率100% |
| **F-013** | HyD Code 历史追溯 | 基于 HyD Code 快速查找绑定历史版本的构件，对比更新前后功能变化 | 精确的版本对比和问题追溯 | 高 | 版本比对引擎、HyD Code索引 | 能够快速定位并对比同一构件的历史版本 |
| **F-014** | 无HyD Code构件处理 | 对缺少 HyD Code 的构件进行标识，禁止绑定操作并提供明确错误提示 | 确保绑定操作的数据完整性 | 高 | 构件属性验证、错误提示系统 | 无HyD Code构件100%被正确识别和处理 |
| **F-015** | HyD筛选范围检测与确认 | 检测点击条目的关联构件是否超出当前HyD筛选范围，超出时弹出确认对话框询问用户是否清除筛选条件查看所有关联构件 | 避免用户操作失误，提供用户选择的灵活性 | 最高 | HyD筛选器、构件关联系统、确认对话框组件 | 范围检测准确率100%，用户确认后操作准确执行 |

#### 模块四：视图交互与高亮系统

| 功能ID | 模块 | 描述 | 目标 | 优先级 | 依赖 | 成功标准 |
| --- | --- | --- | --- | --- | --- | --- |
| **F-016** | 构件选择与批量操作 | 支持框选/点选/筛选器多选构件，提供Select All和Clear All功能，支持一键选择/清除所有HyD筛选结果构件，操作区显示已选构件数量 | 提供完整的构件交互能力，提高批量操作效率 | 高 | Viewer SDK、批量操作框架 | 多选准确率100%，批量选择准确率100% |
| **F-017** | 构件高亮与聚焦 | 点击构件或关联资源时，在 Viewer 中高亮构件 | 可视化定位构件 | 高 | Viewer SDK | 高亮响应≤1s，定位精准 |
| **F-018** | BIM视图与列表双向联动 | 点击列表条目自动高亮关联构件并筛选另一个列表显示相关项目；点击BIM构件自动筛选两侧列表显示相关条目；明确区分筛选联动和点击选择联动：主动筛选列表操作（搜索、标签选择等）不影响BIM视图高亮的独立性，保持点击构件/条目的选择联动功能 | 实现数据间的即时双向联动交互，确保筛选和选择行为的独立性 | 最高 | 事件处理服务、高亮系统、构件选择系统、列表筛选系统、F-048双向联合筛选管理 | 点击响应时间≤1s，联动准确率100%，筛选独立性验证通过 |
| **F-019** | 高亮系统统一管理 | 筛选高亮(黄色)与手动高亮(蓝色)的统一管理，蓝色优先级更高 | 明确的高亮状态管理 | 最高 | 高亮状态管理器 | 高亮状态变化实时响应 |
| **F-020** | 清除筛选功能 | 支持分层清除筛选条件单一筛选条件清除和所有筛选条件清除：可以分层点击清除Hydcode或者文件或者RISC列表的筛选条件，也有一键清除所有筛选条件、高亮选择和列表状态的功能 | 快速重置系统状态 | 高 | 状态管理工具类 | 清除操作完整性100% |
| **F-021** | 右键菜单管理 | 在高亮构件上右键选择"管理关联文件"快速进入文件管理 | 提供快捷的操作入口 | 中 | 右键菜单组件 | 右键菜单响应时间≤300ms |

#### 模块五：资源关联与绑定

| 功能ID | 模块 | 描述 | 目标 | 优先级 | 依赖 | 成功标准 |
| --- | --- | --- | --- | --- | --- | --- |
| **F-022** | 构件绑定文件 | 授权用户和管理员可选择构件后关联ACC文件（多选），必须指定文件版本，记录绑定时间，授权用户只能绑定自己上传的文件 | 构件↔文件多对多关系 | 高 | 文件版本接口、构件选择器、F-004权限校验 | 绑定记录含精确版本和时间信息，权限控制准确 |
| **F-023** | 构件绑定表单 | 授权用户和管理员可将构件关联到DWSS系统的RISC表单（支持多对多），记录表单ID和跳转URL | 连接模型与业务数据 | 高 | DWSS表单API、权限校验 | 点击可跳转至正确表单页 |
| **F-024** | 构件与资源双向关联查询 | 选择构件时展示所有关联的文件（含版本）和表单列表；点击文件/表单时高亮所有关联构件 | 构件与资源的双向追溯和关联视图 | 高 | 绑定关系表、绑定关系索引、前端展示组件、Viewer SDK | 实时显示完整资源记录，关联构件全部高亮显示 |
| **F-025** | 智能删除绑定 | 删除构件-文件绑定关系时智能判断影响范围，提供不同级别确认提示，授权用户只能删除自有文件绑定 | 防止误操作和数据丢失 | 高 | 绑定关系分析、智能提示系统、F-004权限校验 | 准确识别影响范围，提供清晰警告，权限控制准确 |
| **F-026** | 绑定关系修改 | 授权用户和管理员可修改文件关联的构件集合（增删构件），授权用户仅限自有文件 | 动态调整资源结构 | 高 | 构件选择器、版本管理、F-004权限校验 | 修改后视图实时更新，权限控制准确 |
| **F-027** | 绑定关系可视化管理 | 提供关系图谱界面管理构件↔文件/表单的复杂关联关系，支持拖拽式批量关联/解绑和网络图展示 | 高效维护复杂绑定关系，可视化管理多对多关系 | 中 | 关系图谱组件、拖拽交互组件 | 支持拖拽式批量关联/解绑，关系图谱清晰展示 |
| **F-028** | 基于高亮构件的文件添加 | 只有蓝色高亮构件才能进行文件关联操作，包含状态检查 | 确保文件关联的准确性 | 高 | 构件选择系统、按钮状态管理 | 添加按钮状态准确响应 |

#### 模块六：文件管理

| 功能ID | 模块 | 描述 | 目标 | 优先级 | 依赖 | 成功标准 |
| --- | --- | --- | --- | --- | --- | --- |
| **F-029** | 文件预览 | 在嵌入式 Viewer 中预览文件，基于用户的CDE权限范围 | 无需跳转 ACC 查看文件 | 高 | ACC Viewer SDK、CDE权限校验 | 预览打开成功率≥99%，权限控制准确 |
| **F-032** | 文件时间记录 | 记录文件上传时间（首次关联时间）和更新时间（任何关联变更时间），标识上传者 | 确保绑定时间准确性 | 高 | ACC 版本 API、版本历史表、时间戳记录、用户关联 | 时间记录准确，上传者信息完整 |
| **F-033** | 文件重复检测 | 上传文件前检测文件是否已存在于系统中，阻止重复上传，并向用户明确提示已存在的文件信息（文件名） | 避免文件冗余和管理混乱，提供清晰的重复文件反馈 | 高 | 文件指纹识别、重复检测算法、用户反馈组件 | 重复文件检测准确率100%，用户反馈信息完整准确 |
| **F-034** | 文件列表高级筛选 | 按文件名搜索、类型选择、上传日期范围、个人文件、绑定状态等主动筛选手段进行文件筛选；支持双向联合筛选：可与HyD Code筛选双向联动，筛选结果不直接影响BIM视图高亮 | 快速定位目标文件，支持多维度联合筛选 | 高 | 文件筛选服务、F-048双向联合筛选管理 | 筛选结果准确率≥98%，双向联动响应时间≤1s |
| **F-035** | 文件编辑权限 | 授权用户可新增文件并修改/删除自己上传的文件，可修改自己上传文件的文件类型；管理员可对所有文件执行所有操作；文件名和所有标签均不可修改（完全由F-046统一标签系统自动管理） | 精细化文件管理权限 | 中 | 权限系统、文件编辑组件、文件所有权跟踪、F-046统一标签系统、F-047文件类型管理 | 权限控制准确性100%，文件所有权验证正确，标签修改完全禁止，文件类型修改准确 |

#### 模块七：RISC表单管理

| 功能ID | 模块 | 描述 | 目标 | 优先级 | 依赖 | 成功标准 |
| --- | --- | --- | --- | --- | --- | --- |
| **F-036** | 表单跳转 | 点击表单链接（requesat no.)在新窗口打开 DWSS的RISC表单详情页 | 快速访问原始业务数据 | 高 | DWSS URL 拼接逻辑 | 正确打开目标表单页 |
| **F-037** | DWSS 系统对接配置 | 管理员配置 DWSS API 密钥、表单模板映射规则 | 确保表单跳转准确性 | 高 | 系统配置模块 | 点击表单正确跳转目标系统 |
| **F-038** | RISC表单高级筛选 | 按请求编号搜索、inspection选择、状态选择、日期范围等主动筛选手段进行RISC表单筛选，支持基于F-046统一标签系统自动生成的RISC标签进行筛选；支持双向联合筛选：可独立筛选，可与HyD Code筛选双向联动，保持与BIM视图的独立性 | 精确定位RISC记录，支持多维度联合筛选 | 高 | 筛选组件、模糊搜索、F-046统一标签系统、F-048双向联合筛选管理 | 筛选响应时间≤500ms，标签筛选准确率≥98%，双向联动准确率100% |

#### 模块八：系统管理与工具

| 功能ID | 模块 | 描述 | 目标 | 优先级 | 依赖 | 成功标准 |
| --- | --- | --- | --- | --- | --- | --- |
| **F-039** | 资源详情面板 | 展示构件绑定资源的详细信息：文件版本/上传时间/更新时间、表单状态/创建者等 | 提供完整资源上下文 | 高 | 资源元数据接口 | 关键信息完整展示 |
| **F-040** | 审计日志 | 记录关键操作：用户登录、绑定/解绑、文件关联等（操作者、时间、对象 ID），管理员可查看所有用户和仪表板的活动日志 | 数据变更追踪 | 中 | 日志系统 | 所有操作可追溯 |
| **F-041** | 构件索引缓存 | 缓存解析后的构件数据（HyD Code、属性），支持增量更新 | 提升重复访问性能 | 中 | 缓存服务 | 二次加载时间减少 50% |
| **F-042** | 报表导出 | 导出项目资源报表（构件绑定覆盖率、文件分布等） | 业务数据分析 | 低 | 报表引擎 | 导出 Excel/PDF 格式完整 |
| **F-043** | 全局搜索 | 跨项目检索构件（HyD Code）、文件、表单，基于用户权限范围 | 快速定位资源 | 中 | 全文索引引擎、权限校验 | 搜索结果精准排序，权限控制准确 |
| **F-044** | 资源回收站 | 删除的绑定关系进入回收站，支持恢复或永久清除 | 防止误操作数据丢失 | 低 | 软删除机制 | 数据可恢复，保留操作记录 |
| **F-045** | 通知中心 | 关键操作结果通知（绑定成功/失败、模型更新完成） | 实时反馈系统状态 | 低 | 消息推送服务 | 用户及时感知操作结果 |
| **F-046** | 统一标签系统 | 系统根据文件类型、上传时间、关联构件等信息自动生成文件标签；根据DWSS中的RISC表单属性自动生成RISC标签；为所有标签相关功能提供统一的自动标签生成和管理服务 | 集中化标签管理，确保标签系统的一致性和自动化 | 中 | 标签表、文件-标签关系表、自动标签生成引擎、RISC标签生成引擎、F-047文件类型管理 | 标签自动分配准确率≥98%，标签规则统一管理，系统无人工标签操作 |
| **F-047** | 文件类型管理 | 管理员可在后台添加、修改、删除文件类型，支持文件类型的层级分类和属性定义；删除文件类型时检查是否有关联文件，如有则禁止删除并提示具体文件信息 | 为文件分类和标签系统提供基础数据管理 | 中 | 文件类型表、文件类型关联检查服务、管理后台界面 | 文件类型操作成功率100%，关联检查准确率100%，删除限制有效 |
| **F-048** | 双向联合筛选管理 | 统一管理HyD Code筛选和标签筛选的状态，支持双向筛选：HyD Code筛选→标签筛选 或 标签筛选→HyD Code筛选；明确区分主动筛选操作（搜索、标签选择、下拉筛选器）与点击交互行为；保持标签筛选与BIM视图高亮的独立性 | 实现灵活的多维度联合筛选，提高数据检索效率 | 高 | 筛选状态管理器、筛选链路管理、可视化筛选界面 | 双向筛选响应≤1s，筛选状态管理准确率100%，筛选独立性验证通过 |

### 权限模型整合说明

#### 用户角色定义
根据提供的权限参考，系统采用三级用户角色：

1. **普通用户 (View-only User)**
   - 查看所有项目、模型及关联的RISC表单和ACC文件
   - 查看链接到特定BIM构件的文档和表单
   - 使用基础筛选功能
   - 无任何修改或操作权限

2. **授权用户 (Authorized User)**
   - 拥有普通用户的所有权限
   - 可进入"文件管理"页面，新增文件，修改/删除自己上传的文件
   - 可修改自己上传文件的文件类型
   - 可进入"绑定模式"，修改自己上传文件的绑定关系

3. **管理员 (Administrator)**
   - 无范围限制地查看所有项目、模型、RISC表单和ACC文件
   - 查看所有用户和仪表板的活动日志
   - 可对所有文件执行所有操作（新增、删除、编辑）
   - 可进入"绑定模式"，修改任何文件的绑定关系
   - 访问独立的管理后台
   - 管理已通过CDE登录用户的系统内角色及权限
   - 通过邮箱邀请用户进入仪表板
   - 管理文件类型（添加、修改、删除文件类型定义）

#### 权限集成特点
- **权限继承机制**：高级角色继承低级角色的所有权限
- **邮箱邀请机制**：管理员通过邮箱邀请用户授权进入仪表盘并分配角色
- **文件所有权跟踪**：系统自动记录每个文件的上传者信息，实现基于文件所有权的权限验证
- **标签系统自动化**：所有标签（文件标签、RISC标签）完全由系统基于数据特征自动生成和管理

### 功能优化总结

**优化效果**：将原有的 54 个功能精简为 48 个，消除重复和交叉，提高功能清晰度。

**主要优化内容**：
1. **权限模型整合**：根据实际用户角色重新定义权限相关功能
2. **CDE权限集成**：在相关功能中加入CDE权限继承和校验机制
3. **合并重复功能**：合并功能重复的项目，提高功能边界清晰度
4. **精细化权限控制**：明确每个功能的权限要求和验证机制
5. **文件所有权集成**：将文件所有权跟踪集成到F-004权限继承功能中
6. **标签系统自动化**：所有标签系统（文件标签、RISC标签）完全自动化，无需人工干预
7. **统一标签系统**：新增F-046统一标签系统，将所有标签管理功能集中到系统管理模块
8. **文件类型管理**：新增F-047文件类型管理功能，提供管理员对文件类型的完整管理能力
9. **增强用户反馈**：文件重复检测等功能提供更详细的用户反馈信息

这样的权限模型更符合实际的业务需求，确保了系统的安全性和可用性。